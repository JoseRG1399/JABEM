"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[814],{6814:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var a=s(4246),r=s(1147),n=s.n(r),o=s(7378),l=s(5370),i=s.n(l);function d(e){var t,s,r,n,l,d,c;let{sale:x,onClose:u,empresa:m}=e,b=(0,o.useRef)(null),[p,f]=(0,o.useState)(!1);if(!x)return null;(0,o.useEffect)(()=>{if(!p){let e=setTimeout(()=>{h(),f(!0)},500);return()=>clearTimeout(e)}},[p]);let h=()=>{var e;if(!b.current)return;let t=window.open("","_blank");t&&(t.document.write("\n      <html><head><title>Ticket #".concat(null!==(e=null==x?void 0:x.id)&&void 0!==e?e:"","</title>\n      <style>\n        body { font-family: 'Courier New', monospace; font-size:12px; margin:0; padding:20px; width:80mm; }\n        .ticket-header { text-align:center; border-bottom:2px dashed #000; padding-bottom:10px; margin-bottom:10px; }\n        .ticket-header h2 { margin:5px 0; font-size:16px; }\n        .ticket-info { margin:10px 0; font-size:11px; }\n        .ticket-items { border-top:1px dashed #000; border-bottom:1px dashed #000; padding:10px 0; margin:10px 0; }\n        .item { margin:5px 0; }\n        .item-name { font-weight:bold; }\n        .item-details { display:flex; justify-content:space-between; margin-top:2px; }\n        .ticket-total { margin-top:10px; padding-top:10px; border-top:2px dashed #000; }\n        .total-row { display:flex; justify-content:space-between; font-size:14px; font-weight:bold; margin:5px 0; }\n        .ticket-footer { text-align:center; margin-top:15px; padding-top:10px; border-top:1px dashed #000; font-size:11px; }\n        @media print { body { padding:0; } }\n      </style></head>\n      <body>").concat(b.current.innerHTML,"</body></html>\n    ")),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},250))},j=async()=>{(await i().fire({title:"Imprimir Copia",text:"\xbfDeseas imprimir una copia del ticket?",icon:"question",showCancelButton:!0,confirmButtonText:"S\xed, imprimir",cancelButtonText:"No",confirmButtonColor:"#038C65"})).isConfirmed&&h()},g=e=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e||0);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-[#091B26]",children:"Ticket de Venta"}),(0,a.jsx)("button",{onClick:u,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,a.jsxs)("div",{ref:b,className:"ticket-content",children:[(0,a.jsxs)("div",{className:"ticket-header",children:[(0,a.jsx)("h2",{children:(null==m?void 0:m.nombre_empresa)||"La Forrajera Feliz"}),(0,a.jsx)("p",{children:(null==m?void 0:m.direccion)||"Toluca, MX"}),(0,a.jsxs)("p",{children:["Tel: ",(null==m?void 0:m.telefono)||"722-123-4567"]}),(null==m?void 0:m.rfc)?(0,a.jsxs)("p",{children:["RFC: ",m.rfc]}):null]}),(0,a.jsxs)("div",{className:"ticket-info",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Folio:"})," #",null!==(s=null==x?void 0:x.id)&&void 0!==s?s:""]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Fecha:"})," ",(null==x?void 0:x.fecha)?new Date(x.fecha).toLocaleString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Vendedor:"})," ",null!==(r=null==x?void 0:null===(t=x.usuario)||void 0===t?void 0:t.nombre)&&void 0!==r?r:"N/A"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"M\xe9todo de Pago:"})," ",{efectivo:"Efectivo",tarjeta:"Tarjeta",transferencia:"Transferencia"}[null==x?void 0:x.metodo_pago]||(null==x?void 0:x.metodo_pago)||"-"]})]}),(0,a.jsxs)("div",{className:"ticket-items",children:[(0,a.jsx)("h3",{className:"font-bold mb-2",children:"Productos:"}),Array.isArray(null==x?void 0:x.detalle)&&x.detalle.length>0?x.detalle.map((e,t)=>{var s,r,n,o,l,i;return(0,a.jsxs)("div",{className:"item",children:[(0,a.jsx)("div",{className:"item-name",children:null!==(n=null==e?void 0:null===(s=e.producto)||void 0===s?void 0:s.nombre)&&void 0!==n?n:"-"}),(0,a.jsxs)("div",{className:"item-details",children:[(0,a.jsxs)("span",{children:[Number(null!==(o=null==e?void 0:e.cantidad_presentacion)&&void 0!==o?o:0).toFixed(2)," x ",(null==e?void 0:null===(r=e.presentacion)||void 0===r?void 0:r.nombre)||"unidad"]}),(0,a.jsx)("span",{children:g(Number(null!==(l=null==e?void 0:e.precio_unitario)&&void 0!==l?l:0))})]}),(0,a.jsxs)("div",{className:"item-details",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsx)("span",{className:"font-bold",children:g(Number(null!==(i=null==e?void 0:e.subtotal)&&void 0!==i?i:0))})]})]},t)}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Sin productos"})]}),(0,a.jsxs)("div",{className:"ticket-total",children:[Number(null==x?void 0:x.descuento_porcentaje)>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"total-row",style:{fontSize:"12px",fontWeight:"normal"},children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsx)("span",{children:g(Number(null!==(l=null!==(n=null==x?void 0:x.subtotal)&&void 0!==n?n:null==x?void 0:x.total)&&void 0!==l?l:0))})]}),(0,a.jsxs)("div",{className:"total-row",style:{fontSize:"12px",fontWeight:"normal",color:"#d97706"},children:[(0,a.jsxs)("span",{children:["Descuento (",null==x?void 0:x.descuento_porcentaje,"%):"]}),(0,a.jsxs)("span",{children:["-",g(Number(null!==(d=null==x?void 0:x.descuento_monto)&&void 0!==d?d:0))]})]})]}),(0,a.jsxs)("div",{className:"total-row",children:[(0,a.jsx)("span",{children:"TOTAL:"}),(0,a.jsx)("span",{children:g(Number(null!==(c=null==x?void 0:x.total)&&void 0!==c?c:0))})]})]}),(0,a.jsxs)("div",{className:"ticket-footer",children:[(0,a.jsx)("p",{children:"\xa1Gracias por su compra!"}),(0,a.jsx)("p",{children:"Vuelva pronto"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,a.jsx)("button",{onClick:j,className:"flex-1 px-4 py-2 bg-[#038C65] text-white rounded-lg hover:brightness-110 transition-all",children:"Imprimir Copia"}),(0,a.jsx)("button",{onClick:u,className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-all",children:"Cerrar"})]})]})})})}var c=s(6134),x=s(1630),u=s(1899),m=s(5272),b=s(4143),p=s(7542),f=s(4129),h=s(2253),j=s(5490);function g(){let[e,t]=(0,o.useState)(""),[s,r]=(0,o.useState)(""),[l,g]=(0,o.useState)(1),[v,N]=(0,o.useState)(!1),[y,w]=(0,o.useState)(0),[C,k]=(0,o.useState)(!1),[E,_]=(0,o.useState)(0),[S,P]=(0,o.useState)(""),[D,B]=(0,o.useState)(!1),[T,z]=(0,o.useState)(-1),F=(0,o.useRef)(null),[Z,A]=(0,o.useState)([]),[L,V]=(0,o.useState)([]),[M,I]=(0,o.useState)(0),[X,K]=(0,o.useState)(null),[O,R]=(0,o.useState)(!1),[q,J]=(0,o.useState)(null),[U,W]=(0,o.useState)(!1),[G,H]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=window.localStorage.getItem("jabemUser");e&&H(JSON.parse(e)),Q(),Y()},[]),(0,o.useEffect)(()=>{let e=e=>{F.current&&!F.current.contains(e.target)&&B(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let Q=async()=>{try{let e=await fetch("/api/sales/productos");if(e.ok){let t=await e.json();A(t)}}catch(e){console.error("Error loading products:",e),i().fire("Error","No se pudieron cargar los productos","error")}},Y=async()=>{try{let e=await fetch("/api/config/configuracion");if(e.ok){let t=await e.json();J(t)}}catch(e){console.error("Error loading empresa:",e)}},$=Z.find(t=>t.id===e),ee=(null==$?void 0:$.presentaciones.filter(e=>"kg"!==$.unidad_base||"kg suelto"!==e.nombre.toLowerCase()))||[],et=Z.filter(e=>{var t,s;let a=S.toLowerCase(),r=e.nombre.toLowerCase().includes(a),n=(null===(s=e.categoria)||void 0===s?void 0:null===(t=s.nombre)||void 0===t?void 0:t.toLowerCase().includes(a))||!1;return r||n}),es=e=>{var s,a;t(e.id),P("".concat(e.nombre," - ").concat((null===(s=e.categoria)||void 0===s?void 0:s.nombre)||"")),B(!1),z(-1);try{if("kg"!==e.unidad_base&&Array.isArray(e.presentaciones)){let t=e.presentaciones.find(e=>"pieza"===e.nombre.toLowerCase()||"pza"===e.nombre.toLowerCase()||"unidad"===e.nombre.toLowerCase());if(t){r(t.id);try{null==ea||null===(a=ea.current)||void 0===a||a.focus()}catch(e){}return}}r("")}catch(e){r("")}},ea=(0,o.useRef)(null),er=e=>{let t=e.presentaciones.find(e=>"kg"===e.unidad&&1===Number(e.factor_a_base));return t||(t=e.presentaciones.find(e=>"kg"===e.unidad&&e.es_default)),t||(t=e.presentaciones.find(e=>"kg"===e.unidad)),t?Number(t.precio_unitario):0},en=e=>{let t=e.presentaciones.find(e=>"kg"===e.unidad&&1===Number(e.factor_a_base));return t||(t=e.presentaciones.find(e=>"kg"===e.unidad&&e.es_default)),t||(t=e.presentaciones.find(e=>"kg"===e.unidad)),t},eo=e=>{V(L.filter((t,s)=>s!==e))},el=(e,t)=>{let s=[...L],a=s[e],r=a.cantidad+t;if(r<=0){eo(e);return}let n=Number(a.presentacion.precio_unitario);if(isNaN(n)){console.error("❌ Precio unitario inv\xe1lido al actualizar cantidad:",a.presentacion.precio_unitario),i().fire("Error","Error al actualizar la cantidad. Precio inv\xe1lido.","error");return}s[e].cantidad=r,s[e].subtotal=r*n,console.log("\uD83D\uDD04 Cantidad actualizada:",{producto:a.producto.nombre,presentacion:a.presentacion.nombre,cantidad_anterior:a.cantidad,cantidad_nueva:r,precio_unitario:n,subtotal_nuevo:s[e].subtotal}),V(s)},ei=()=>L.reduce((e,t)=>e+t.subtotal,0),ed=()=>ei()*M/100,ec=()=>ei()-ed(),ex=async()=>{if(0===L.length){i().fire("Atenci\xf3n","El carrito est\xe1 vac\xedo","warning");return}if(!G){i().fire("Error","No hay usuario autenticado","error");return}if((await i().fire({title:"Confirmar Venta",html:'\n        <div class="text-left">\n          '.concat(M>0?'<p class="mb-2 text-center"><strong>Subtotal:</strong> '.concat(eu(ei()),"</p>"):"","\n          ").concat(M>0?'<p class="mb-2 text-center"><strong>Descuento ('.concat(M,"%):</strong> -").concat(eu(ed()),"</p>"):"",'\n          <p class="mb-2 text-lg text-center"><strong>Total:</strong> ').concat(eu(ec()),'</p>\n          <p class="mb-2 text-center"><strong>M\xe9todo de Pago:</strong> Efectivo</p>\n          <p class="text-normal text-gray-600 text-center">\xbfDeseas procesar esta venta?</p>\n        </div>\n      '),icon:"question",iconColor:"#038C65",showCancelButton:!0,theme:"borderless",confirmButtonText:"S\xed, procesar",cancelButtonText:"Cancelar",confirmButtonColor:"#038C65"})).isConfirmed){W(!0);try{let e={usuario_id:G.id,metodo_pago:"efectivo",descuento_porcentaje:M,items:L.map(e=>({presentacion_id:e.presentacion.id,cantidad:e.cantidad}))},t=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"Error al procesar la venta")}let s=await t.json();K(s),V([]),I(0),R(!0),await i().fire({title:"\xa1Venta Exitosa!",text:"Venta #".concat(s.id," procesada correctamente"),icon:"success",confirmButtonColor:"#038C65",timer:1500,showConfirmButton:!1}),Q()}catch(e){console.error("Error processing sale:",e),i().fire("Error",e.message||"No se pudo procesar la venta","error")}finally{W(!1)}}},eu=e=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e),em=(e,t)=>{let s=Number(e);if(isNaN(s))throw console.error("❌ Precio inv\xe1lido en ".concat(t,":"),e),Error("Precio inv\xe1lido: ".concat(e));if(s<0)throw console.error("❌ Precio negativo en ".concat(t,":"),e),Error("El precio no puede ser negativo: ".concat(e));return s};return(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 lg:col-span-2 space-y-6",children:(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-xl p-6 border border-gray-200",children:[(0,a.jsxs)("h2",{className:"jsx-ad81230456f8b669 text-2xl font-bold text-[#091B26] mb-6 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 p-2 bg-[#038C65] rounded-lg",children:(0,a.jsx)(c.Z,{className:"w-6 h-6 text-white"})}),"Agregar Productos"]}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 space-y-5",children:[(0,a.jsxs)("div",{ref:F,className:"jsx-ad81230456f8b669 relative",children:[(0,a.jsx)("label",{className:"jsx-ad81230456f8b669 block text-sm font-semibold text-gray-700 mb-2",children:"Buscar Producto"}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 relative",children:[(0,a.jsx)(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:S,onChange:e=>{P(e.target.value),B(!0),z(-1),e.target.value||(t(""),r(""))},onFocus:()=>B(!0),onKeyDown:e=>{if(D&&0!==et.length)switch(e.key){case"ArrowDown":e.preventDefault(),z(e=>e<et.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),z(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),T>=0&&T<et.length&&es(et[T]);break;case"Escape":e.preventDefault(),B(!1),z(-1)}},placeholder:"Busca por nombre o categor\xeda...",autoComplete:"off",className:"jsx-ad81230456f8b669 w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-[#038C65] focus:border-[#038C65] transition-all bg-white"}),e&&(0,a.jsx)("button",{type:"button",onClick:()=>{t(""),P(""),r(""),B(!1)},className:"jsx-ad81230456f8b669 absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"\xd7"})]}),D&&S&&et.length>0&&(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 absolute z-10 w-full mt-1 bg-white border-2 border-gray-300 rounded-xl shadow-lg max-h-60 overflow-y-auto",children:et.map((e,t)=>{var s;return(0,a.jsxs)("button",{type:"button",onClick:()=>es(e),className:"jsx-ad81230456f8b669 "+"w-full text-left px-4 py-3 transition-colors border-b border-gray-200 last:border-b-0 ".concat(t===T?"bg-[#038C65] text-white":"hover:bg-[#038C65] hover:text-white"),children:[(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 font-semibold",children:e.nombre}),(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 "+"text-xs ".concat(t===T?"text-white":"text-gray-500"),children:(null===(s=e.categoria)||void 0===s?void 0:s.nombre)||"Sin categor\xeda"})]},e.id)})}),D&&S&&0===et.length&&(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 absolute z-10 w-full mt-1 bg-white border-2 border-gray-300 rounded-xl shadow-lg p-4 text-center text-gray-500",children:"No se encontraron productos"})]}),e&&(null==$?void 0:$.unidad_base)==="kg"&&(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 bg-blue-50 border-2 border-blue-200 rounded-xl p-4",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex items-center justify-between mb-3",children:[(0,a.jsxs)("label",{className:"jsx-ad81230456f8b669 flex items-center gap-2 text-sm font-semibold text-gray-700",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-blue-600"}),"Vender por peso (tanto)"]}),(0,a.jsx)("button",{type:"button",onClick:()=>{N(!v),r(""),w(0),_(0),k(!1)},className:"jsx-ad81230456f8b669 "+"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(v?"bg-[#038C65]":"bg-gray-300"),children:(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 "+"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(v?"translate-x-6":"translate-x-1")})})]}),v&&(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 bg-purple-50 border-2 border-purple-200 rounded-xl p-3 mb-3",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex items-center justify-center gap-3",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 "+"flex items-center gap-2 transition-all ".concat(C?"text-gray-500":"text-[#038C65] font-bold"),children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-xs font-semibold",children:"Peso"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{k(!C),w(0),_(0)},className:"jsx-ad81230456f8b669 "+"relative inline-flex h-5 w-9 items-center rounded-full transition-colors ".concat(C?"bg-gray-300":"bg-[#038C65]"),children:(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 "+"inline-block h-3 w-3 transform rounded-full bg-white transition-transform ".concat(C?"translate-x-5":"translate-x-1")})}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 "+"flex items-center gap-2 transition-all ".concat(C?"text-purple-600 font-bold":"text-gray-500"),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-xs font-semibold",children:"Dinero"})]})]}),(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 text-xs text-gray-600 mt-2 text-center",children:C?"Ingresa el dinero y se calcular\xe1 el peso autom\xe1ticamente":"Ingresa el peso en kilogramos"})]}),er($)>0?(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 bg-white rounded-lg p-2",children:[(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 text-xs text-gray-600",children:"Precio base (Kg suelto):"}),(0,a.jsxs)("p",{className:"jsx-ad81230456f8b669 text-lg font-bold text-[#038C65]",children:[eu(er($))," / kg"]}),v&&(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 text-xs text-blue-600 mt-1",children:"✓ Se cobrar\xe1 sobre este precio"})]}):(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 bg-red-50 rounded-lg p-2",children:(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 text-xs text-red-600",children:"⚠️ Este producto no tiene precio por kg definido"})})]}),v&&e?(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 space-y-4",children:C?(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669",children:[(0,a.jsxs)("label",{className:"jsx-ad81230456f8b669 block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"Cantidad de Dinero"]}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:E||"",onChange:e=>{let t=parseFloat(e.target.value)||0;_(t);let s=er($);s>0&&w(t/s)},placeholder:"Ej: 100",className:"jsx-ad81230456f8b669 w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all"}),E>0&&(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 mt-2 bg-white rounded-lg p-3 border border-purple-200",children:[(0,a.jsxs)("p",{className:"jsx-ad81230456f8b669 text-sm text-gray-600",children:["Peso calculado: ",(0,a.jsxs)("span",{className:"jsx-ad81230456f8b669 font-bold text-purple-600",children:[y.toFixed(2)," kg"]})]}),(0,a.jsxs)("p",{className:"jsx-ad81230456f8b669 text-xs text-gray-500 mt-1",children:["Precio base: ",eu(er($))," / kg"]})]})]}):(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669",children:[(0,a.jsxs)("label",{className:"jsx-ad81230456f8b669 block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"Peso en Kilogramos"]}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:y||"",onChange:e=>w(parseFloat(e.target.value)||0),placeholder:"Ej: 2.5",className:"jsx-ad81230456f8b669 w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-[#038C65] focus:border-[#038C65] transition-all"}),y>0&&(0,a.jsxs)("p",{className:"jsx-ad81230456f8b669 mt-2 text-sm text-gray-600",children:["Subtotal: ",(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 font-bold text-[#038C65]",children:eu(er($)*y)})]})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669",children:[(0,a.jsxs)("label",{className:"jsx-ad81230456f8b669 block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),"Presentaci\xf3n"]}),(0,a.jsxs)("select",{value:s,onChange:e=>r(Number(e.target.value)||""),disabled:!e,className:"jsx-ad81230456f8b669 w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-[#038C65] focus:border-[#038C65] transition-all disabled:bg-gray-100 disabled:cursor-not-allowed",children:[(0,a.jsx)("option",{value:"",className:"jsx-ad81230456f8b669",children:"Selecciona una presentaci\xf3n"}),ee.map(e=>{let t=Number(e.precio_unitario),s=!isNaN(t)&&t>=0;return(0,a.jsxs)("option",{value:e.id,className:"jsx-ad81230456f8b669",children:[e.nombre," - ",s?eu(t):"⚠️ Precio inv\xe1lido (".concat(e.precio_unitario,")")]},e.id)})]})]}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669",children:[(0,a.jsx)("label",{className:"jsx-ad81230456f8b669 block text-sm font-semibold text-gray-700 mb-2",children:"Cantidad"}),(0,a.jsx)("input",{ref:ea,type:"number",min:"1",value:l,onChange:e=>g(Math.max(1,parseInt(e.target.value)||1)),className:"jsx-ad81230456f8b669 w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-[#038C65] focus:border-[#038C65] transition-all"})]})]}),(0,a.jsxs)("button",{onClick:()=>{if(!e){i().fire("Atenci\xf3n","Selecciona un producto","warning");return}let a=Z.find(t=>t.id===e);if(!a)return;if(v){if(y<=0){i().fire("Atenci\xf3n","Ingresa un peso v\xe1lido en kilogramos","warning");return}let e=er(a);if(0===e){i().fire({icon:"error",title:"Producto sin precio por kg",html:'\n            <p>Este producto no tiene una presentaci\xf3n en kilogramos.</p>\n            <p class="text-sm text-gray-600 mt-2">Aseg\xfarate de que el producto tenga una presentaci\xf3n "Kg suelto" con precio definido.</p>\n          '});return}let s=en(a);if(!s){i().fire("Error","No se encontr\xf3 presentaci\xf3n en kg para este producto","error");return}V([...L,{producto:a,presentacion:s,cantidad:y,subtotal:e*y,precioBase:e,esVentaPorPeso:!0}]),w(0),_(0),t(""),P(""),r(""),B(!1),z(-1),N(!1);return}if(!s||l<=0){i().fire("Atenci\xf3n","Selecciona una presentaci\xf3n y cantidad v\xe1lida","warning");return}let n=null==a?void 0:a.presentaciones.find(e=>e.id===s);if(!n){i().fire("Error","No se encontr\xf3 la presentaci\xf3n seleccionada","error");return}try{console.log("\uD83D\uDD0D Datos de presentaci\xf3n:",{producto:a.nombre,presentacion:n.nombre,precio_unitario:n.precio_unitario,tipo_precio:typeof n.precio_unitario,cantidad:l,unidad:n.unidad});let e=em(n.precio_unitario,"presentaci\xf3n ".concat(n.nombre)),t=Number(l);if(isNaN(t)||t<=0){i().fire("Error","La cantidad no es v\xe1lida","error");return}let s=e*t;console.log("\uD83E\uDDEE C\xe1lculo exitoso:",{precio:e,cantidad:t,subtotal:s,subtotal_formateado:eu(s)})}catch(e){i().fire({icon:"error",title:"Error en el precio",html:'\n          <p>El precio de la presentaci\xf3n "'.concat(n.nombre,'" no es v\xe1lido.</p>\n          <p class="text-sm text-gray-600 mt-2">Valor recibido: ').concat(n.precio_unitario,'</p>\n          <p class="text-sm text-gray-600">Error: ').concat(e.message,"</p>\n        ")});return}let o=em(n.precio_unitario,"presentaci\xf3n ".concat(n.nombre))*l,d=L.findIndex(e=>e.presentacion.id===s&&!e.esVentaPorPeso);if(d>=0){let e=[...L];e[d].cantidad+=l,e[d].subtotal+=o,V(e)}else V([...L,{producto:a,presentacion:n,cantidad:l,subtotal:o,esVentaPorPeso:!1}]);t(""),P(""),r(""),g(1),_(0),B(!1),z(-1),N(!1)},className:"jsx-ad81230456f8b669 w-full px-6 py-4 bg-gradient-to-r from-[#038C65] to-[#026B4E] text-white rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all font-bold text-lg flex items-center justify-center gap-2",children:[(0,a.jsx)(p.Z,{className:"w-6 h-6"}),"Agregar al Carrito"]})]})]})}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-xl p-6 border border-gray-200 sticky top-6",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex items-center justify-between mb-6",children:[(0,a.jsxs)("h2",{className:"jsx-ad81230456f8b669 text-2xl font-bold text-[#091B26] flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-6 h-6 text-[#038C65]"}),"Carrito"]}),L.length>0&&(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 px-3 py-1 bg-[#038C65] text-white rounded-full text-sm font-bold",children:L.length})]}),(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 space-y-3 mb-4 max-h-[350px] overflow-y-auto pr-2 custom-scrollbar",children:0===L.length?(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 text-center py-12",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 text-gray-400 font-medium",children:"Carrito vac\xedo"})]}):L.map((e,t)=>(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 border-2 border-gray-200 rounded-xl p-4 space-y-3 bg-white hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex-1",children:[(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 font-bold text-sm text-[#091B26]",children:e.producto.nombre}),(0,a.jsx)("p",{className:"jsx-ad81230456f8b669 text-xs text-gray-500 flex items-center gap-1 mt-1",children:e.esVentaPorPeso?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Z,{className:"w-3 h-3"}),"Por peso"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{className:"w-3 h-3"}),e.presentacion.nombre]})})]}),(0,a.jsx)("button",{onClick:()=>eo(t),className:"jsx-ad81230456f8b669 text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex items-center justify-between",children:[e.esVentaPorPeso?(0,a.jsxs)("span",{className:"jsx-ad81230456f8b669 text-sm font-medium text-gray-600",children:[e.cantidad.toFixed(2)," kg"]}):(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>el(t,-1),className:"jsx-ad81230456f8b669 p-1.5 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:(0,a.jsx)(h.Z,{className:"w-3 h-3"})}),(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-sm font-bold w-10 text-center bg-gray-100 py-1 rounded",children:e.cantidad}),(0,a.jsx)("button",{onClick:()=>el(t,1),className:"jsx-ad81230456f8b669 p-1.5 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:(0,a.jsx)(p.Z,{className:"w-3 h-3"})})]}),(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-sm font-bold text-[#038C65]",children:eu(e.subtotal)})]})]},t))}),L.length>0&&(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 mb-4 bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4",children:[(0,a.jsxs)("label",{className:"jsx-ad81230456f8b669 block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 text-yellow-600"}),"Descuento (%)"]}),(0,a.jsx)("input",{type:"number",min:"0",max:"100",step:"1",value:M||"",onChange:e=>{I(Math.min(100,Math.max(0,parseFloat(e.target.value)||0)))},placeholder:"0",className:"jsx-ad81230456f8b669 w-full px-4 py-2 border-2 border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 transition-all"}),M>0&&(0,a.jsxs)("p",{className:"jsx-ad81230456f8b669 mt-2 text-xs text-yellow-700 font-medium",children:["Ahorro: ",eu(ed())]})]}),L.length>0&&(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 border-t-2 border-gray-300 pt-4 mb-4 space-y-2",children:[(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex justify-between items-center text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"jsx-ad81230456f8b669",children:"Subtotal:"}),(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 font-semibold",children:eu(ei())})]}),M>0&&(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex justify-between items-center text-sm text-yellow-600",children:[(0,a.jsxs)("span",{className:"jsx-ad81230456f8b669",children:["Descuento (",M,"%):"]}),(0,a.jsxs)("span",{className:"jsx-ad81230456f8b669 font-semibold",children:["-",eu(ed())]})]}),(0,a.jsxs)("div",{className:"jsx-ad81230456f8b669 flex justify-between items-center text-2xl font-bold pt-2 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-[#091B26]",children:"Total:"}),(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-[#038C65]",children:eu(ec())})]})]}),L.length>0&&(0,a.jsx)("div",{className:"jsx-ad81230456f8b669 mb-4 bg-green-50 border-2 border-green-200 rounded-xl p-3",children:(0,a.jsxs)("p",{className:"jsx-ad81230456f8b669 text-sm font-semibold text-gray-700 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-green-600"}),"M\xe9todo de Pago: ",(0,a.jsx)("span",{className:"jsx-ad81230456f8b669 text-green-700",children:"Efectivo"})]})}),(0,a.jsxs)("button",{onClick:ex,disabled:0===L.length||U,className:"jsx-ad81230456f8b669 w-full px-6 py-4 bg-gradient-to-r from-[#038C65] to-[#026B4E] text-white rounded-xl hover:shadow-xl hover:scale-[1.02] transition-all font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-6 h-6"}),U?"Procesando...":"Finalizar Venta"]})]}),O&&X&&(0,a.jsx)(d,{sale:X,onClose:()=>R(!1),empresa:q}),(0,a.jsx)(n(),{id:"ad81230456f8b669",children:".custom-scrollbar.jsx-ad81230456f8b669::-webkit-scrollbar{width:6px}.custom-scrollbar.jsx-ad81230456f8b669::-webkit-scrollbar-track{background:#f1f1f1;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px}.custom-scrollbar.jsx-ad81230456f8b669::-webkit-scrollbar-thumb{background:#038C65;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px}.custom-scrollbar.jsx-ad81230456f8b669::-webkit-scrollbar-thumb:hover{background:#026B4E}"})]})}}}]);