(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[361],{4342:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/usuarios",function(){return a(8966)}])},8966:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return n}});var r=a(4246),t=a(7378);function n(){let[e,s]=(0,t.useState)([]),[a,n]=(0,t.useState)(!0),[l,i]=(0,t.useState)(null),[o,d]=(0,t.useState)({nombre:"",usuario:"",password:"",rol:"vendedor"}),[c,x]=(0,t.useState)(null),[u,m]=(0,t.useState)(!1),[h,p]=(0,t.useState)(""),[b,g]=(0,t.useState)("todos"),[j,f]=(0,t.useState)(1);async function N(){try{n(!0),i(null);let e=await fetch("/api/usuarios/listar"),a=await e.json();s(a||[])}catch(e){i("Error al cargar usuarios")}finally{n(!1)}}function v(e){d(s=>({...s,[e.target.name]:e.target.value}))}async function y(e){e.preventDefault(),x(null),m(!0);try{let e=await fetch("/api/usuarios/crear",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),s=await e.json();if(!e.ok)throw Error((null==s?void 0:s.error)||"Error al crear usuario");d({nombre:"",usuario:"",password:"",rol:"vendedor"}),await N()}catch(e){x(e.message||"Error al crear usuario")}finally{m(!1)}}async function w(a){let r=e.find(e=>e.id===a);if(!r||!window.confirm('\xbfEliminar a "'.concat(r.nombre,'"? Esta acci\xf3n no se puede deshacer.')))return;let t=[...e];s(e=>e.filter(e=>e.id!==a));try{if(!(await fetch("/api/usuarios/eliminar",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a})})).ok)throw Error("No se pudo eliminar")}catch(e){s(t),alert("Error al eliminar usuario")}}(0,t.useEffect)(()=>{N()},[]);let C=(0,t.useMemo)(()=>{let s=h.trim().toLowerCase(),a=e.filter(e=>{let a=!s||"".concat(e.nombre," ").concat(e.usuario," ").concat(e.rol).toLowerCase().includes(s),r="todos"===b||e.rol===b;return a&&r});return a.sort((e,s)=>e.nombre.localeCompare(s.nombre)),a},[e,h,b]),k=Math.max(1,Math.ceil(C.length/8)),E=Math.min(j,k),S=(0,t.useMemo)(()=>C.slice((E-1)*8,8*E),[C,E]);return(0,t.useEffect)(()=>{f(1)},[h,b]),(0,r.jsx)("div",{className:"min-h-screen bg-[#091B26] p-6 sm:p-8 text-neutral-900",children:(0,r.jsxs)("div",{className:"mx-auto max-w-6xl space-y-6",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/menuPrincipal",className:"mb-4 px-4 py-2 rounded-xl bg-[#038C65] text-white font-semibold shadow hover:bg-[#027857]",children:"← Volver al men\xfa principal"}),(0,r.jsxs)("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-[#038C65] tracking-tight",children:"Gesti\xf3n de usuarios"}),(0,r.jsx)("p",{className:"text-sm !text-white",children:"Administra el acceso al sistema. Crea, busca y elimina usuarios."})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-white px-4 py-2 text-center shadow-sm",children:[(0,r.jsx)("div",{className:"!text-sm !text-neutral-900",children:"Total"}),(0,r.jsx)("div",{className:"!text-lg !font-semibold !text-neutral-900",children:e.length})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white px-4 py-2 text-center shadow-sm",children:[(0,r.jsx)("div",{className:"!text-sm text-neutral-900",children:"Mostrando"}),(0,r.jsx)("div",{className:"!text-lg font-semibold !text-neutral-900",children:C.length})]})]})]}),(0,r.jsxs)("section",{className:"grid gap-6 lg:grid-cols-3",children:[(0,r.jsxs)("div",{className:"lg:col-span-1 rounded-2xl border bg-white p-5 shadow-sm",children:[(0,r.jsx)("h2",{className:"mb-4 text-base font-semibold text-neutral-800",children:"Crear usuario"}),(0,r.jsxs)("form",{className:"grid grid-cols-1 gap-3",onSubmit:y,children:[(0,r.jsx)("input",{name:"nombre",value:o.nombre,onChange:v,placeholder:"Nombre",required:!0,className:"rounded-xl border px-3 py-2 outline-none ring-0 focus:border-[#038C65]/50 focus:ring-2 focus:ring-[#038C65]/20 text-black bg-white"}),(0,r.jsx)("input",{name:"usuario",value:o.usuario,onChange:v,placeholder:"Usuario",required:!0,className:"rounded-xl border px-3 py-2 outline-none ring-0 focus:border-[#038C65]/50 focus:ring-2 focus:ring-[#038C65]/20 text-black bg-white"}),(0,r.jsx)("input",{name:"password",value:o.password,onChange:v,placeholder:"Contrase\xf1a",type:"password",required:!0,className:"rounded-xl border px-3 py-2 outline-none ring-0 focus:border-[#038C65]/50 focus:ring-2 focus:ring-[#038C65]/20 text-black bg-white"}),(0,r.jsxs)("select",{name:"rol",value:o.rol,onChange:v,className:"rounded-xl border px-3 py-2 outline-none ring-0 focus:border-[#038C65]/50 focus:ring-2 focus:ring-[#038C65]/20 text-black bg-white",children:[(0,r.jsx)("option",{value:"admin",children:"Admin"}),(0,r.jsx)("option",{value:"vendedor",children:"Vendedor"})]}),(0,r.jsxs)("button",{type:"submit",disabled:u,className:"mt-2 inline-flex items-center justify-center gap-2 rounded-xl bg-[#038C65] px-4 py-2 font-semibold text-white shadow-sm transition hover:bg-[#027857] disabled:opacity-60",children:[(0,r.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4",children:(0,r.jsx)("path",{d:"M10 3a1 1 0 0 1 1 1v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5H4a1 1 0 1 1 0-2h5V4a1 1 0 0 1 1-1z"})}),u?"Creando...":"Crear usuario"]}),c&&(0,r.jsx)("div",{className:"text-sm text-red-600",children:c})]})]}),(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,r.jsx)("div",{className:"rounded-2xl border bg-white p-4 shadow-sm",children:(0,r.jsxs)("div",{className:"grid gap-3 sm:grid-cols-3",children:[(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{value:h,onChange:e=>p(e.target.value),placeholder:"Buscar por nombre, usuario o rol...",className:"w-full rounded-xl border px-3 py-2 pl-9 outline-none ring-0 focus:border-[#038C65]/50 focus:ring-2 focus:ring-[#038C65]/20 text-black bg-white"}),(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"pointer-events-none absolute left-2.5 top-2.5 h-5 w-5 text-neutral-400",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,r.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("select",{value:b,onChange:e=>g(e.target.value),className:"w-full rounded-xl border px-3 py-2 outline-none ring-0 focus:border-[#038C65]/50 focus:ring-2 focus:ring-[#038C65]/20 text-black bg-white",children:[(0,r.jsx)("option",{value:"todos",children:"Todos los roles"}),(0,r.jsx)("option",{value:"admin",children:"Admin"}),(0,r.jsx)("option",{value:"vendedor",children:"Vendedor"})]})})]})}),(0,r.jsxs)("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full text-left text-sm text-black",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-[#038C65]/10 text-[#045b45]",children:[(0,r.jsx)("th",{className:"px-4 py-3 font-semibold",children:"#"}),(0,r.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Nombre"}),(0,r.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Usuario"}),(0,r.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Rol"}),(0,r.jsx)("th",{className:"px-4 py-3 font-semibold",children:"Activo"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Acciones"})]})}),(0,r.jsxs)("tbody",{className:"divide-y",children:[a&&[...Array(6)].map((e,s)=>(0,r.jsxs)("tr",{className:"animate-pulse",children:[(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"h-4 w-6 rounded bg-neutral-200"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"h-4 w-40 rounded bg-neutral-200"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"h-4 w-32 rounded bg-neutral-200"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"h-6 w-20 rounded-full bg-neutral-200"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"h-6 w-12 rounded-full bg-neutral-200"})}),(0,r.jsx)("td",{className:"px-4 py-3 text-right",children:(0,r.jsx)("div",{className:"ml-auto h-8 w-24 rounded bg-neutral-200"})})]},"skeleton-".concat(s))),!a&&0===S.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"px-4 py-10 text-center text-neutral-500",children:"No se encontraron usuarios con los filtros aplicados."})}),!a&&S.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-neutral-50",children:[(0,r.jsx)("td",{className:"px-4 py-3 text-neutral-500",children:e.id}),(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-neutral-800",children:e.nombre}),(0,r.jsx)("td",{className:"px-4 py-3 text-neutral-700",children:e.usuario}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-semibold ".concat("admin"===e.rol?"bg-emerald-100 text-emerald-700":"bg-sky-100 text-sky-700"),children:[(0,r.jsx)("span",{className:"h-2 w-2 rounded-full bg-current"}),e.rol]})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ".concat(!1===e.activo?"bg-neutral-200 text-neutral-600":"bg-green-100 text-green-700"),children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full ".concat(!1===e.activo?"bg-neutral-500":"bg-green-600")}),!1===e.activo?"No":"S\xed"]})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,r.jsxs)("button",{onClick:()=>w(e.id),className:"inline-flex items-center gap-2 rounded-lg border border-red-200 bg-red-50 px-3 py-1.5 text-sm font-semibold text-red-700 transition hover:bg-red-100",title:"Eliminar",children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[(0,r.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,r.jsx)("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),(0,r.jsx)("path",{d:"M10 11v6"}),(0,r.jsx)("path",{d:"M14 11v6"}),(0,r.jsx)("path",{d:"M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"})]}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Eliminar"})]})})})]},e.id))]})]})}),!a&&C.length>8&&(0,r.jsxs)("div",{className:"flex items-center justify-between border-t px-4 py-3",children:[(0,r.jsxs)("div",{className:"text-sm text-neutral-600",children:["P\xe1gina ",(0,r.jsx)("span",{className:"font-semibold",children:E})," de ",k]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===E,className:"rounded-lg border px-3 py-1.5 text-sm font-medium text-neutral-700 disabled:opacity-50",children:"Anterior"}),(0,r.jsx)("button",{onClick:()=>f(e=>Math.min(k,e+1)),disabled:E===k,className:"rounded-lg border px-3 py-1.5 text-sm font-medium text-neutral-700 disabled:opacity-50",children:"Siguiente"})]})]})]}),l&&(0,r.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:l})]})]})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4342)}),_N_E=e.O()}]);