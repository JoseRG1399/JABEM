(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{4180:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reportes",function(){return a(6430)}])},6430:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var s=a(4246),i=a(7378),n=a(7365),l=a(5566),r=a(5370),o=a.n(r);function d(){let[e,t]=(0,i.useState)({filas:[]}),[a,n]=(0,i.useState)(!1),[r,d]=(0,i.useState)("MXN"),[c,m]=(0,i.useState)(""),[x,u]=(0,i.useState)(1);function p(e){try{return new Intl.NumberFormat("es-MX",{style:"currency",currency:r}).format(e||0)}catch(t){return"$".concat(Number(e||0).toFixed(2))}}function h(e){let t=Number(e);return Number.isFinite(t)?t.toFixed(3):"0.000"}async function g(){try{n(!0);let e=await fetch("/api/reportes/ventas-dia"),a=await e.json();if(!e.ok)throw Error(a.error||"Error al obtener ventas del d\xeda");t({filas:Array.isArray(a.filas)?a.filas:[]})}catch(e){o().fire("Error",(null==e?void 0:e.message)||"No se pudo obtener el reporte","error")}finally{n(!1)}}(0,i.useEffect)(()=>{g()},[]),(0,i.useEffect)(()=>{fetch("/api/config/configuracion").then(e=>e.ok?e.json():null).then(e=>{(null==e?void 0:e.moneda)&&d(e.moneda)}).catch(()=>{})},[]);let b=(0,i.useMemo)(()=>{let t=[...e.filas||[]];return(c?t.filter(e=>(e.nombre||"").toLowerCase().includes(c.toLowerCase())):t).sort((e,t)=>Number(t.total||0)-Number(e.total||0))},[e.filas,c]),v=(0,i.useMemo)(()=>b.reduce((e,t)=>e+Number(t.total||0),0),[b]),f=(0,i.useMemo)(()=>b.reduce((e,t)=>e+Number(t.cantidad||0),0),[b]),y=(0,i.useMemo)(()=>b.length,[b]),N=(0,i.useMemo)(()=>{var e;return(null===(e=b[0])||void 0===e?void 0:e.nombre)||"—"},[b]),j=(0,i.useMemo)(()=>b.slice(0,10),[b]),w=(0,i.useMemo)(()=>({labels:j.map(e=>e.nombre),datasets:[{label:"Total ventas (dinero)",data:j.map(e=>Number(e.total||0)),backgroundColor:"rgba(3,140,101,0.7)"}]}),[j]),k=(0,i.useMemo)(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>{let t=Number(e.parsed.y||0);return" ".concat(p(t))}}}},scales:{x:{ticks:{color:"#334155"}},y:{ticks:{color:"#334155",callback:e=>p(Number(e))},beginAtZero:!0}}}),[r]);async function E(){try{let e=null;try{let t=await fetch("/api/config/configuracion");t.ok&&(e=await t.json())}catch(t){e=null}let t=new Date().toLocaleString(),a=e=>null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),s=b.map(e=>{var t;return{nombre:a(e.nombre||""),cantidad:h(null!==(t=e.cantidad)&&void 0!==t?t:0),total:p(Number(e.total||0))}}),i=p(v),n=s.map(e=>'<div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;line-height:1.1;"><div style="flex:1">'.concat(e.nombre,'</div><div style="min-width:60px;text-align:right">').concat(e.cantidad,'</div><div style="min-width:80px;text-align:right;margin-left:8px">').concat(e.total,"</div></div>")).join(""),l=(null==e?void 0:e.nombre_empresa)?'<div style="font-size:13px;font-weight:700;margin-top:4px">'.concat(a(e.nombre_empresa),"</div>"):"",r=(null==e?void 0:e.direccion)?'<div style="font-size:11px;margin-top:4px">'.concat(a(e.direccion),"</div>"):"",d=(null==e?void 0:e.telefono)?'<div style="font-size:11px;margin-top:2px">Tel: '.concat(a(e.telefono),"</div>"):"",c='<!doctype html><html><head><meta charset="utf-8"><title>Ticket</title><style>@page{size:80mm auto;margin:5mm}body{font-family:monospace;font-size:12px;width:80mm;padding:6mm;margin:0} .center{text-align:center} .divider{border-top:1px dashed #000;margin:6px 0}</style></head><body><div class="center" style="font-weight:700;font-size:14px">'.concat("JABEM","</div>").concat(l).concat(r).concat(d," ").concat("Reporte de Ventas del D\xeda",'<div class="center" style="font-size:11px;margin-top:6px">Fecha y hora: ').concat(t,'</div><div class="divider"></div>').concat(n,'<div class="divider"></div><div style="display:flex;justify-content:space-between;padding-top:6px;font-size:13px;font-weight:700"><div>Total</div><div style="min-width:80px;text-align:right">').concat(i,"</div></div></body></html>"),m=window.open("","_blank","toolbar=0,location=0,menubar=0");if(!m){o().fire("Error","No se pudo abrir la ventana de impresi\xf3n. Revisa bloqueadores de ventanas emergentes.","error");return}m.document.open(),m.document.write(c),m.document.close(),m.focus(),setTimeout(()=>{try{m.print()}catch(e){console.error(e)}},600)}catch(e){o().fire("Error",(null==e?void 0:e.message)||"Error al generar ticket","error")}}return(0,s.jsxs)("div",{className:"min-h-screen bg-[#091B26] p-6",children:[(0,s.jsx)("button",{onClick:()=>window.location.href="/menuPrincipal",className:"mb-4 px-4 py-2 rounded-xl bg-[#038C65] text-white font-semibold shadow hover:bg-[#027857]",children:"← Volver al men\xfa principal"}),(0,s.jsxs)("div",{className:"max-w-6xl mx-auto bg-white rounded-xl p-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-[#038C65]",children:"Reportes - Ventas del d\xeda"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>window.location.href="/reportes/historico",className:"px-3 py-2 rounded bg-[#0EA5A5] text-white",children:"Hist\xf3rico por fechas"}),(0,s.jsx)("button",{onClick:g,className:"px-3 py-2 rounded bg-gray-100",children:"Actualizar"}),(0,s.jsx)("button",{onClick:E,disabled:!b.length,className:"px-3 py-2 rounded bg-gray-100 disabled:opacity-50",children:"Imprimir"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Ingreso del d\xeda"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:p(v)})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Unidades vendidas"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:h(f)})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Productos distintos"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:y})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Top producto"}),(0,s.jsx)("div",{className:"text-xl font-semibold truncate",title:N,children:N})]})]}),(0,s.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,s.jsx)("input",{value:c,onChange:e=>{m(e.target.value),u(1)},placeholder:"Buscar producto...",className:"rounded border px-3 py-2 w-full max-w-sm"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Resultados: ",b.length]})]}),a?(0,s.jsx)("div",{children:"Cargando..."}):(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Ventas por producto (hoy)"}),(0,s.jsx)("div",{className:"overflow-auto max-h-[360px]",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-[#F2F0EB]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Producto"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Cantidad"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Total"})]})}),(0,s.jsx)("tbody",{children:b.length?(()=>{let e=(x-1)*10;return b.slice(e,e+10).map((t,a)=>{var i,n;return(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:t.nombre}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:h(null!==(i=t.cantidad)&&void 0!==i?i:0)}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:p(Number(t.total||0))})]},null!==(n=t.productoId)&&void 0!==n?n:"row-".concat(e+a))})})():(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"p-4 text-gray-500",children:"No hay ventas hoy"})})})]})}),b.length>10&&(0,s.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["P\xe1gina ",x," de ",Math.max(1,Math.ceil(b.length/10))]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{disabled:x<=1,onClick:()=>u(e=>Math.max(1,e-1)),className:"px-3 py-1 rounded bg-gray-100",children:"Anterior"}),(0,s.jsx)("button",{disabled:x>=Math.ceil(b.length/10),onClick:()=>u(e=>Math.min(Math.ceil(b.length/10),e+1)),className:"px-3 py-1 rounded bg-gray-100",children:"Siguiente"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold mb-2",children:["Top ",10," productos por ingreso"]}),(0,s.jsx)("div",{style:{height:360},children:(0,s.jsx)(l.$Q,{data:w,options:k})})]})]})]})]})}n.kL.register(n.ZL,n.uw,n.f$,n.u,n.De)}},function(e){e.O(0,[398,106,322,888,774,179],function(){return e(e.s=4180)}),_N_E=e.O()}]);