(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{7075:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reportes/historico",function(){return a(9425)}])},9425:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var s=a(4246),r=a(7378),n=a(7365),l=a(5566),c=a(5370),d=a.n(c);function i(){let[e,t]=(0,r.useState)(""),[a,n]=(0,r.useState)(""),[c,i]=(0,r.useState)({byDay:[],byProduct:[]}),[o,x]=(0,r.useState)(!1),[h,m]=(0,r.useState)(1),[u,b]=(0,r.useState)(""),[p,g]=(0,r.useState)("MXN"),y=(0,r.useRef)(null);function N(e){try{return new Intl.NumberFormat("es-MX",{style:"currency",currency:p}).format(e)}catch(t){return"$".concat(Number(e||0).toFixed(2))}}function j(e){let t=Number(e);return Number.isFinite(t)?t.toFixed(3):"0.000"}async function f(){if(!e||!a)return d().fire("Error","Selecciona rango de fechas","error");try{var t,s;x(!0);let r=await fetch("/api/reportes/ventas-historico?start=".concat(encodeURIComponent(e),"&end=").concat(encodeURIComponent(a))),n=await r.json();if(!r.ok)throw Error(n.error||"Error al obtener hist\xf3rico");i({byDay:null!==(t=n.byDay)&&void 0!==t?t:[],byProduct:null!==(s=n.byProduct)&&void 0!==s?s:[]})}catch(e){d().fire("Error",(null==e?void 0:e.message)||"No se pudo obtener hist\xf3rico","error")}finally{x(!1)}}async function v(e,a){try{var s,r;x(!0);let l=await fetch("/api/reportes/ventas-historico?start=".concat(encodeURIComponent(e),"&end=").concat(encodeURIComponent(a))),c=await l.json();if(!l.ok)throw Error(c.error||"Error al obtener hist\xf3rico");i({byDay:null!==(s=c.byDay)&&void 0!==s?s:[],byProduct:null!==(r=c.byProduct)&&void 0!==r?r:[]}),t(e),n(a)}catch(e){d().fire("Error",(null==e?void 0:e.message)||"No se pudo obtener hist\xf3rico","error")}finally{x(!1)}}function w(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)}function E(e){let t=new Date,a=new Date;a.setDate(t.getDate()-(e-1)),v(w(a),w(t)),b(String(e))}(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/config/configuracion");if(e.ok){let t=await e.json();(null==t?void 0:t.moneda)&&g(t.moneda)}}catch(e){}})()},[]);let C=r.useMemo(()=>{let e=Array.isArray(c.byProduct)?[...c.byProduct]:[];e.sort((e,t)=>(t.cantidad||0)-(e.cantidad||0));let t=e.slice(0,10),a=e.slice(10).reduce((e,t)=>e+Number(t.cantidad||0),0),s=t.map(e=>e.nombre),r=t.map(e=>Number(e.cantidad||0));a>0&&(s.push("Otros"),r.push(a));let n=["#0EA5A5","#0369A1","#0F1724","#065F46","#7C3AED","#B91C1C","#F59E0B","#10B981","#06B6D4","#EF4444","#64748B"],l=s.map((e,t)=>n[t%n.length]);return{labels:s,datasets:[{label:"Cantidad vendida",data:r,backgroundColor:l}]}},[c.byProduct]),F=c.byProduct.reduce((e,t)=>e+(t.cantidad||0),0),A=c.byProduct.reduce((e,t)=>e+(t.total||0),0),D=c.byDay.length||1;return(0,s.jsxs)("div",{className:"min-h-screen bg-[#091B26] p-6",children:[(0,s.jsx)("button",{onClick:()=>window.location.href="/reportes",className:"mb-4 px-4 py-2 rounded-xl bg-[#038C65] text-white font-semibold shadow hover:bg-[#027857]",children:"← Volver"}),(0,s.jsxs)("div",{className:"max-w-6xl mx-auto bg-white rounded-xl p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-[#038C65] mb-2",children:"Reportes - Hist\xf3rico de ventas por fechas"}),(0,s.jsx)("p",{className:"mb-4 text-gray-700",children:"Selecciona las fechas y consulta. Tambi\xe9n puedes usar “Hoy” o “\xdaltimos 7/30 d\xedas”."}),(0,s.jsxs)("div",{className:"flex items-end flex-wrap gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm text-gray-600 mb-1",children:"Fecha inicio"}),(0,s.jsx)("input",{type:"date",value:e,onChange:e=>t(e.target.value),className:"rounded border px-3 py-2"})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"text-sm text-gray-600 mb-1",children:"Fecha fin"}),(0,s.jsx)("input",{type:"date",value:a,onChange:e=>n(e.target.value),className:"rounded border px-3 py-2"})]}),(0,s.jsx)("button",{onClick:f,className:"px-3 py-2 rounded bg-[#0EA5A5] text-white",children:"Consultar"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:function(){let e=w(new Date);v(e,e),b("today")},className:"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 ".concat("today"===u?"ring-2 ring-[#0EA5A5] border-2 border-[#0EA5A5]":""),children:"Hoy"}),(0,s.jsx)("button",{onClick:()=>E(7),className:"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 ".concat("7"===u?"ring-2 ring-[#0EA5A5] border-2 border-[#0EA5A5]":""),children:"\xdaltimos 7 d\xedas"}),(0,s.jsx)("button",{onClick:()=>E(30),className:"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 ".concat("30"===u?"ring-2 ring-[#0EA5A5] border-2 border-[#0EA5A5]":""),children:"\xdaltimos 30 d\xedas"})]}),(0,s.jsx)("button",{onClick:()=>{t(""),n(""),b(""),i({byDay:[],byProduct:[]})},className:"px-3 py-2 rounded bg-gray-100",children:"Limpiar"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Ingresos"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:N(A)})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Unidades"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:F})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"D\xedas"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:D})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-[#F2F0EB]",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Promedio/d\xeda"}),(0,s.jsx)("div",{className:"text-xl font-semibold",children:N(A/D)})]})]}),o?(0,s.jsx)("div",{children:"Cargando..."}):(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Distribuci\xf3n por cantidad vendida (por producto)"}),(0,s.jsx)("div",{style:{height:320},children:(0,s.jsx)(l.by,{ref:y,data:C,options:{responsive:!0,maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:e=>{let t=e.label||"",a=Number(e.parsed||0),s=e.chart.data.datasets[0].data.reduce((e,t)=>e+Number(t||0),0),r=s?a/s*100:0,n=0;if("Otros"!==t){let e=(c.byProduct||[]).find(e=>e.nombre===t);n=e?Number(e.total||0):0}return"".concat(t,": ").concat(j(a)," (").concat(r.toFixed(1),"%) — ").concat(N(n))}}},legend:{labels:{generateLabels:e=>{let t=e.data.datasets[0],a=(t.data||[]).reduce((e,t)=>e+Number(t||0),0);return e.data.labels.map((e,s)=>{let r=Number(t.data[s]||0);return{text:"".concat(e," (").concat((a?r/a*100:0).toFixed(1),"%)"),fillStyle:t.backgroundColor[s],hidden:!1,index:s}})}}}}}})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Ventas por producto"}),(0,s.jsx)("div",{className:"overflow-auto max-h-80",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-[#F2F0EB]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Producto"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Cantidad"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Total"})]})}),(0,s.jsx)("tbody",{children:c.byProduct.length?(()=>{let e=c.byProduct.length,t=Math.max(1,Math.ceil(e/10)),a=Math.min(Math.max(1,h),t),r=(a-1)*10,n=r+10,l=c.byProduct.slice(r,n);return(0,s.jsxs)(s.Fragment,{children:[l.map((e,t)=>{var a,n;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.nombre}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:j(null!==(a=e.cantidad)&&void 0!==a?a:0)}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:N(Number(e.total||0))})]},(null!==(n=e.productoId)&&void 0!==n?n:0)||"p-".concat(r+t))}),(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"px-3 py-2",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Mostrando ",r+1,"–",Math.min(n,e)," de ",e]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:a<=1,className:"px-3 py-1 rounded ".concat(a<=1?"bg-gray-200 text-gray-500":"bg-[#0EA5A5] text-white"),children:"Anterior"}),(0,s.jsxs)("div",{className:"text-sm",children:["P\xe1gina ",a," / ",t]}),(0,s.jsx)("button",{onClick:()=>m(e=>Math.min(t,e+1)),disabled:a>=t,className:"px-3 py-1 rounded ".concat(a>=t?"bg-gray-200 text-gray-500":"bg-[#0EA5A5] text-white"),children:"Siguiente"})]})]})})})]})})():(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"p-4 text-gray-500",children:"No hay datos"})})})]})})]}),(0,s.jsxs)("div",{className:"lg:col-span-2",children:[(0,s.jsx)("h3",{className:"font-semibold mb-2",children:"Ventas por d\xeda"}),(0,s.jsx)("div",{className:"overflow-auto max-h-80",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{className:"bg-[#F2F0EB]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Fecha"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Unidades"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Total"})]})}),(0,s.jsx)("tbody",{children:c.byDay.length?c.byDay.map(e=>{var t;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.fecha}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:j(null!==(t=e.cantidad)&&void 0!==t?t:0)}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:N(Number(e.total||0))})]},e.fecha)}):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"p-4 text-gray-500",children:"No hay datos"})})})]})})]})]})]})]})}n.kL.register(n.qi,n.u,n.De)}},function(e){e.O(0,[398,106,322,888,774,179],function(){return e(e.s=7075)}),_N_E=e.O()}]);