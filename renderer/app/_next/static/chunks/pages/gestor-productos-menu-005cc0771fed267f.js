(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{3471:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var r=a(7378);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),i=e=>{let t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:o="",children:i,iconNode:d,...u},p)=>(0,r.createElement)("svg",{ref:p,...c,width:t,height:t,stroke:e,strokeWidth:s?24*Number(a)/Number(t):a,className:n("lucide",o),...!i&&!l(u)&&{"aria-hidden":"true"},...u},[...d.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(i)?i:[i]])),u=(e,t)=>{let a=(0,r.forwardRef)(({className:a,...o},l)=>(0,r.createElement)(d,{ref:l,iconNode:t,className:n(`lucide-${s(i(e))}`,`lucide-${e}`,a),...o}));return a.displayName=i(e),a}},6159:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/gestor-productos-menu",function(){return a(257)}])},257:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var r=a(4246),s=a(7378),o=a(5370),i=a.n(o),n=a(3471);let l=(0,n.Z)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),c=(0,n.Z)("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);function d(){let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)(!1),[n,d]=(0,s.useState)(""),[u,p]=(0,s.useState)(1),[x,m]=(0,s.useState)(!1),[h,b]=(0,s.useState)(null),[f,g]=(0,s.useState)(!1),[y,j]=(0,s.useState)({id:0,nombre:"",unidad:"kg",factor_a_base:"",precio_unitario:"",codigo_barras:"",es_default:!1,activo:!0});async function N(){try{o(!0);let e=await fetch("/api/gestion-productos/presentaciones-listar"),a=await e.json();e.ok?t(Array.isArray(a)?a:[]):(console.error("Error al cargar presentaciones:",a.error),t([]))}catch(e){console.error("Error al cargar presentaciones:",e),t([])}finally{o(!1)}}(0,s.useEffect)(()=>{N()},[]);let v=e.filter(e=>{var t;return e.nombre.toLowerCase().includes(n.toLowerCase())||e.producto.nombre.toLowerCase().includes(n.toLowerCase())||((null===(t=e.producto.categoria)||void 0===t?void 0:t.nombre)||"").toLowerCase().includes(n.toLowerCase())}),w=Math.max(1,Math.ceil(v.length/20)),C=v.slice((u-1)*20,20*u);async function _(t){let a=e.find(e=>e.id===t);if(!a)return;let r=a.activo?"desactivar":"activar";if((await i().fire({title:"\xbf".concat(r.charAt(0).toUpperCase()+r.slice(1)," presentaci\xf3n?"),text:"\xbfEst\xe1 seguro de que desea ".concat(r,' "').concat(a.nombre,'"?'),icon:"question",showCancelButton:!0,confirmButtonText:"S\xed, ".concat(r),cancelButtonText:"Cancelar"})).isConfirmed)try{let e=await fetch("/api/gestion-productos/presentaciones-toggle",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})}),a=await e.json();if(e.ok)await i().fire({icon:"success",title:"Estado actualizado",text:a.message,timer:2e3,showConfirmButton:!1}),N();else throw Error(a.error||"Error al cambiar estado")}catch(e){await i().fire({icon:"error",title:"Error",text:e instanceof Error?e.message:"Error al cambiar estado de la presentaci\xf3n"})}}async function k(e){try{g(!0);let t=await fetch("/api/gestion-productos/presentaciones-detalle?id=".concat(e)),a=await t.json();if(t.ok)b(a),j({id:a.id,nombre:a.nombre,unidad:a.unidad,factor_a_base:a.factor_a_base.toString(),precio_unitario:a.precio_unitario.toString(),codigo_barras:a.codigo_barras||"",es_default:a.es_default,activo:a.activo}),m(!0);else throw Error(a.error||"Error al cargar presentaci\xf3n")}catch(e){await i().fire({icon:"error",title:"Error",text:e instanceof Error?e.message:"Error al cargar los datos de la presentaci\xf3n"})}finally{g(!1)}}async function E(){if(!y.nombre.trim()){await i().fire("Error","El nombre es obligatorio","error");return}let e=parseFloat(y.factor_a_base);if(!(e>0)){await i().fire("Error","El factor a base debe ser mayor que 0","error");return}let t=parseFloat(y.precio_unitario);if(!(t>=0)){await i().fire("Error","El precio unitario debe ser 0 o mayor","error");return}try{g(!0);let a=await fetch("/api/gestion-productos/presentaciones-editar",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:y.id,nombre:y.nombre.trim(),unidad:y.unidad,factor_a_base:e,precio_unitario:t,codigo_barras:y.codigo_barras.trim()||null,es_default:y.es_default})}),r=await a.json();if(a.ok)await i().fire({icon:"success",title:"Presentaci\xf3n actualizada",text:r.message,timer:2e3,showConfirmButton:!1}),m(!1),N();else throw Error(r.error||"Error al actualizar presentaci\xf3n")}catch(e){await i().fire({icon:"error",title:"Error",text:e instanceof Error?e.message:"Error al actualizar la presentaci\xf3n"})}finally{g(!1)}}function A(e){i().fire({icon:"info",title:"Ayuda",text:{presentacion:'Nombre descriptivo que identifica la presentaci\xf3n. \xdatil para distinguir variantes del mismo producto (ej: "Bulto 20kg", "Kg suelto", "Pieza"). Debe ser claro para que cajeros y usuarios identifiquen r\xe1pidamente la opci\xf3n al vender o consultar inventario.',nombre:'Nombre descriptivo de la presentaci\xf3n (ej: "Bulto 20kg", "Pieza individual").',unidad:"Unidad de medida de esta presentaci\xf3n. Debe coincidir con el tipo de factor.",factor:"Cu\xe1ntas unidades base equivale esta presentaci\xf3n. Ej: si un bulto son 20 kg, el factor ser\xeda 20. Se utiliza para convertir la cantidad de la presentaci\xf3n a la unidad base del producto y para ajustar inventario y precios correctamente.",precio:"Precio unitario de venta para esta presentaci\xf3n.",codigo:"C\xf3digo de barras opcional para identificaci\xf3n r\xe1pida.",default:"Si est\xe1 marcado, esta ser\xe1 la presentaci\xf3n seleccionada por defecto en las ventas. S\xf3lo una presentaci\xf3n por producto debe ser marcada como por defecto para evitar ambig\xfcedades al crear tickets."}[e]||"No hay ayuda disponible para este campo."})}return(0,r.jsxs)("div",{className:"min-h-screen bg-[#091B26] p-6",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/menuPrincipal",className:"mb-4 px-4 py-2 rounded-xl bg-[#038C65] text-white font-semibold shadow hover:bg-[#027857]",children:"← Volver al men\xfa principal"}),(0,r.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-[#038C65] mb-6",children:"Gestor de Presentaciones de Productos"}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow p-6 mb-6",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,r.jsx)("input",{type:"text",value:n,onChange:e=>{d(e.target.value),p(1)},placeholder:"Buscar por nombre de presentaci\xf3n, producto o categor\xeda...",className:"flex-1 rounded-xl border px-4 py-2 text-black bg-white"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/alta-productos",className:"px-4 py-2 rounded-xl bg-[#0EA5A5] text-white font-semibold shadow hover:opacity-90",title:"Ir a alta de productos",children:"+ Nuevo producto"}),(0,r.jsx)("button",{onClick:N,disabled:a,className:"px-4 py-2 rounded-xl bg-[#038C65] text-white font-semibold shadow hover:bg-[#027857] disabled:opacity-60",children:a?"Cargando...":"Actualizar"})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{className:"bg-[#F2F0EB]",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:"Producto"}),(0,r.jsxs)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:["Presentaci\xf3n",(0,r.jsx)("button",{type:"button",onClick:()=>A("presentacion"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-0.5 rounded",children:"?"})]}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:"Categor\xeda"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:"Unidad"}),(0,r.jsxs)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:["Factor Base",(0,r.jsx)("button",{type:"button",onClick:()=>A("factor"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-0.5 rounded",children:"?"})]}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:"Precio"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:"Estado"}),(0,r.jsxs)("th",{className:"px-4 py-3 text-left text-[#038C65] font-semibold",children:["Default",(0,r.jsx)("button",{type:"button",onClick:()=>A("default"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-0.5 rounded",children:"?"})]}),(0,r.jsx)("th",{className:"px-4 py-3 text-center text-[#038C65] font-semibold",children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:a?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:9,className:"px-4 py-8 text-center text-gray-500",children:"Cargando presentaciones..."})}):0===C.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:9,className:"px-4 py-8 text-center text-gray-500",children:n?"No se encontraron presentaciones que coincidan con la b\xfasqueda":"No hay presentaciones registradas"})}):C.map(e=>{var t;return(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-3",children:e.producto.nombre}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[(0,r.jsx)("div",{className:"font-medium",children:e.nombre}),e.codigo_barras&&(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["C\xf3digo: ",e.codigo_barras]})]}),(0,r.jsx)("td",{className:"px-4 py-3",children:(null===(t=e.producto.categoria)||void 0===t?void 0:t.nombre)||"Sin categor\xeda"}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("span",{className:"capitalize",children:e.unidad})}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.factor_a_base}),(0,r.jsxs)("td",{className:"px-4 py-3",children:["$",e.precio_unitario]}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e.activo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.activo?"Activo":"Inactivo"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.es_default&&(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Por defecto"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,r.jsx)("button",{onClick:()=>k(e.id),disabled:f,className:"p-2 rounded hover:bg-blue-100 text-blue-600",title:"Editar presentaci\xf3n",children:(0,r.jsx)(l,{className:"h-4 w-4"})}),(0,r.jsx)("button",{onClick:()=>_(e.id),className:"p-2 rounded ".concat(e.activo?"bg-[#C8E6C9] text-[#388E3C] hover:bg-[#A5D6A7]":"bg-gray-100 text-gray-500 hover:bg-gray-200"),title:e.activo?"Desactivar":"Activar","aria-pressed":e.activo,children:(0,r.jsx)(c,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),(0,r.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["P\xe1gina ",u," de ",w," — ",v.length," presentaciones"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{disabled:u<=1,onClick:()=>p(e=>Math.max(1,e-1)),className:"px-3 py-1 rounded bg-gray-100",children:"Anterior"}),(0,r.jsx)("button",{disabled:u>=w,onClick:()=>p(e=>Math.min(w,e+1)),className:"px-3 py-1 rounded bg-gray-100",children:"Siguiente"})]})]})]})]}),x&&h&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-xl shadow-lg p-6 m-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("h3",{className:"text-xl font-bold text-[#038C65]",children:["Editar Presentaci\xf3n: ",h.nombre]}),(0,r.jsx)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block font-medium mb-2",children:["Nombre",(0,r.jsx)("button",{type:"button",onClick:()=>A("nombre"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-1 rounded",children:"?"})]}),(0,r.jsx)("input",{type:"text",value:y.nombre,onChange:e=>j(t=>({...t,nombre:e.target.value})),className:"w-full rounded-xl border px-3 py-2",placeholder:"Nombre de la presentaci\xf3n"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block font-medium mb-2",children:["Unidad",(0,r.jsx)("button",{type:"button",onClick:()=>A("unidad"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-1 rounded",children:"?"})]}),(0,r.jsxs)("select",{value:y.unidad,onChange:e=>j(t=>({...t,unidad:e.target.value})),className:"w-full rounded-xl border px-3 py-2",children:[(0,r.jsx)("option",{value:"kg",children:"Kilogramo"}),(0,r.jsx)("option",{value:"bulto",children:"Bulto"}),(0,r.jsx)("option",{value:"pieza",children:"Pieza"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block font-medium mb-2",children:["Factor a base",(0,r.jsx)("button",{type:"button",onClick:()=>A("factor"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-1 rounded",children:"?"})]}),(0,r.jsx)("input",{type:"number",min:"0.0001",step:"0.0001",value:y.factor_a_base,onChange:e=>j(t=>({...t,factor_a_base:e.target.value})),className:"w-full rounded-xl border px-3 py-2",placeholder:"Factor de conversi\xf3n"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block font-medium mb-2",children:["Precio unitario",(0,r.jsx)("button",{type:"button",onClick:()=>A("precio"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-1 rounded",children:"?"})]}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:y.precio_unitario,onChange:e=>j(t=>({...t,precio_unitario:e.target.value})),className:"w-full rounded-xl border px-3 py-2",placeholder:"Precio de venta"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsxs)("label",{className:"block font-medium mb-2",children:["C\xf3digo de barras",(0,r.jsx)("button",{type:"button",onClick:()=>A("codigo"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-1 rounded",children:"?"})]}),(0,r.jsx)("input",{type:"text",value:y.codigo_barras,onChange:e=>j(t=>({...t,codigo_barras:e.target.value})),className:"w-full rounded-xl border px-3 py-2",placeholder:"C\xf3digo de barras (opcional)"})]}),(0,r.jsxs)("div",{className:"md:col-span-2 flex items-center gap-3",children:[(0,r.jsx)("input",{id:"es_default",type:"checkbox",checked:y.es_default,onChange:e=>j(t=>({...t,es_default:e.target.checked}))}),(0,r.jsxs)("label",{htmlFor:"es_default",className:"font-medium",children:["Marcar como presentaci\xf3n por defecto",(0,r.jsx)("button",{type:"button",onClick:()=>A("default"),className:"ml-2 text-sm bg-[#0EA5A5] text-white px-2 py-1 rounded",children:"?"})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>m(!1),disabled:f,className:"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300",children:"Cancelar"}),(0,r.jsx)("button",{onClick:E,disabled:f,className:"px-4 py-2 rounded-xl bg-[#038C65] text-white hover:bg-[#027857] disabled:opacity-60",children:f?"Guardando...":"Guardar cambios"})]})]})})]})}}},function(e){e.O(0,[398,888,774,179],function(){return e(e.s=6159)}),_N_E=e.O()}]);