(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96],{3471:function(e,t,a){"use strict";a.d(t,{Z:function(){return m}});var r=a(7378);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),o=e=>{let t=n(e);return t.charAt(0).toUpperCase()+t.slice(1)},s=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:n="",children:o,iconNode:c,...m},u)=>(0,r.createElement)("svg",{ref:u,...d,width:t,height:t,stroke:e,strokeWidth:i?24*Number(a)/Number(t):a,className:s("lucide",n),...!o&&!l(m)&&{"aria-hidden":"true"},...m},[...c.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(o)?o:[o]])),m=(e,t)=>{let a=(0,r.forwardRef)(({className:a,...n},l)=>(0,r.createElement)(c,{ref:l,iconNode:t,className:s(`lucide-${i(o(e))}`,`lucide-${e}`,a),...n}));return a.displayName=o(e),a}},220:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/inventario",function(){return a(5175)}])},5175:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var r=a(4246),i=a(7378),n=a(5370),o=a.n(n),s=a(3471);let l=(0,s.Z)("circle-arrow-up",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),d=(0,s.Z)("circle-arrow-down",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]);function c(){let[e,t]=(0,i.useState)([]),[a,n]=(0,i.useState)(!1),[s,c]=(0,i.useState)([]),[m,u]=(0,i.useState)(""),[p,h]=(0,i.useState)(1);async function x(){try{n(!0);let e=await fetch("/api/inventario/productos-listar"),a=await e.json();t(Array.isArray(a)?a:[])}catch(e){t([])}finally{n(!1)}}function v(e){return null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function g(e){let t=Number(e);return Number.isFinite(t)?t.toFixed(3):"0.000"}async function y(e){try{let t=await fetch(e?"/api/inventario/movimientos-listar?producto_id=".concat(e):"/api/inventario/movimientos-listar"),a=await t.json();c(Array.isArray(a)?a:[])}catch(e){c([])}}async function f(e){try{let t=await fetch("/api/inventario/movimientos-listar?producto_id=".concat(e)),a=await t.json();if(!t.ok)throw Error(a.error||"Error al obtener movimientos");let r=(Array.isArray(a)?a:[]).slice(0,50).map(e=>{var t;return'\n        <div style="border-bottom:1px solid #eee;padding:6px 0;">\n          <div style="font-weight:600">'.concat((null===(t=e.producto)||void 0===t?void 0:t.nombre)||""," — ").concat(e.tipo_movimiento,'</div>\n          <div style="font-size:12px;color:#666">').concat(new Date(e.fecha).toLocaleString()," — Cantidad: ").concat(e.cantidad_base,'</div>\n          <div style="font-size:12px;color:#444">').concat(e.comentario||"","</div>\n        </div>\n      ")}).join("");o().fire({title:"\xdaltimos movimientos",html:'<div style="max-height:400px;overflow:auto;text-align:left">'.concat(r||"<div>No hay movimientos</div>","</div>"),width:700})}catch(e){o().fire("Error",(null==e?void 0:e.message)||"No se pudieron obtener movimientos","error")}}(0,i.useEffect)(()=>{x(),y()},[]);let b=e.filter(e=>!m||(e.nombre||"").toLowerCase().includes(m.toLowerCase())),w=Math.max(1,Math.ceil(b.length/20)),j=b.slice((p-1)*20,20*p);function N(e,t){o().fire({title:"".concat("ajuste"===t?"Ajuste":"entrada"===t?"Registrar entrada":"Registrar salida"," - ").concat(e.nombre),html:'\n        <input id="swal-cantidad" type="number" class="swal2-input" placeholder="Cantidad (en unidades base)" />\n        <input id="swal-comentario" class="swal2-input" placeholder="Comentario (opcional)" />\n      ',showCancelButton:!0,confirmButtonText:"Guardar",preConfirm:()=>{var e,t;let a=null===(e=document.getElementById("swal-cantidad"))||void 0===e?void 0:e.value,r=null===(t=document.getElementById("swal-comentario"))||void 0===t?void 0:t.value;return a||o().showValidationMessage("La cantidad es obligatoria"),{cantidad:a,comentario:r}}}).then(async a=>{if(!a.isConfirmed)return;let{cantidad:r,comentario:i}=a.value||{};try{let a=await fetch("/api/inventario/ajustar-stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({producto_id:e.id,cantidad:r,tipo:t,razon:i})}),n=await a.json();if(!a.ok)throw Error(n.error||"Error al ajustar stock");o().fire("Listo","Stock actualizado","success"),x(),y(e.id)}catch(e){o().fire("Error",(null==e?void 0:e.message)||"No se pudo ajustar el stock","error")}})}return(0,r.jsxs)("div",{className:"min-h-screen bg-[#091B26] p-6",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/menuPrincipal",className:"mb-4 px-4 py-2 rounded-xl bg-[#038C65] text-white font-semibold shadow hover:bg-[#027857]",children:"← Volver al men\xfa principal"}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"col-span-2 bg-white rounded-xl p-6 shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-[#038C65] mb-4",children:"Productos y arqueo"}),(0,r.jsxs)("div",{className:"mb-4 flex items-center gap-3",children:[(0,r.jsx)("input",{value:m,onChange:e=>{u(e.target.value),h(1)},placeholder:"Buscar producto...",className:"rounded border px-3 py-2 w-full"}),(0,r.jsx)("button",{onClick:()=>{u(""),h(1),x()},className:"px-3 py-2 rounded bg-gray-100",children:"Limpiar"}),(0,r.jsx)("button",{onClick:()=>(function(){try{let t=b&&b.length?b:e;if(!t||0===t.length){o().fire("Sin productos","No hay productos para imprimir en el arqueo.","info");return}let a=new Date().toLocaleString(),r=t.map(e=>{var t;let a=v(e.nombre||""),r=null!==(t=e.stock_actual)&&void 0!==t?t:0,i=v(g(r));return'<div style="display:flex;justify-content:space-between;padding:3px 0;font-size:12px;"><div style="flex:1">'.concat(a,'</div><div style="min-width:60px;text-align:right">').concat(i,"</div></div>")}).join(""),i='<!doctype html><html><head><meta charset="utf-8"><title>Arqueo</title><style>@page{size:80mm auto;margin:5mm}body{font-family:monospace;font-size:12px;width:80mm;padding:4mm;margin:0} .header{text-align:center;font-weight:700;margin-bottom:8px} .divider{border-top:1px dashed #000;margin:6px 0}</style></head><body><div class="header">JABEM - Arqueo de stock<br/><div style="font-weight:400;font-size:11px">'.concat(a,'</div></div><div class="divider"></div>').concat(r,'<div class="divider"></div><div style="text-align:center;margin-top:8px;font-size:11px">--- Fin del reporte ---</div></body></html>'),n=window.open("","_blank","toolbar=0,location=0,menubar=0");if(!n){o().fire("Error","No se pudo abrir la ventana de impresi\xf3n. Revisa bloqueadores de ventanas emergentes.","error");return}n.document.open(),n.document.write(i),n.document.close(),n.focus(),setTimeout(()=>{try{n.print()}catch(e){console.error(e)}},500)}catch(e){o().fire("Error",(null==e?void 0:e.message)||"Error al generar el arqueo","error")}})(),className:"px-3 py-2 rounded bg-[#0F1724] text-white",children:"Imprimir"})]}),a?(0,r.jsx)("div",{children:"Cargando productos..."}):(0,r.jsxs)("table",{className:"min-w-full",children:[(0,r.jsx)("thead",{className:"bg-[#F2F0EB]",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-2 text-center",children:"Nombre"}),(0,r.jsx)("th",{className:"px-3 py-2 text-center",children:"Stock"}),(0,r.jsx)("th",{className:"px-3 py-2 text-center",children:"Unidad"}),(0,r.jsx)("th",{className:"px-3 py-2 text-center",children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:j.map(e=>{var t;return(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-3 py-2",children:e.nombre}),(0,r.jsx)("td",{className:"px-3 py-2",children:g(null!==(t=e.stock_actual)&&void 0!==t?t:0)}),(0,r.jsx)("td",{className:"px-3 py-2",children:e.unidad_base}),(0,r.jsxs)("td",{className:"px-3 py-2 flex gap-2",children:[(0,r.jsxs)("button",{onClick:()=>N(e,"entrada"),className:"px-2 py-1 rounded bg-green-100 text-green-800 flex items-center gap-1",children:[(0,r.jsx)(l,{className:"w-4 h-4"})," Entrada"]}),(0,r.jsxs)("button",{onClick:()=>N(e,"salida"),className:"px-2 py-1 rounded bg-red-100 text-red-800 flex items-center gap-1",children:[(0,r.jsx)(d,{className:"w-4 h-4"})," Salida"]}),(0,r.jsx)("button",{onClick:()=>N(e,"ajuste"),className:"px-2 py-1 rounded bg-gray-100 text-gray-800",children:"Ajuste"}),(0,r.jsx)("button",{onClick:()=>f(e.id),className:"px-2 py-1 rounded bg-blue-100 text-blue-800",children:"Ver movimientos"})]})]},e.id)})})]}),(0,r.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["P\xe1gina ",p," de ",w," — ",b.length," productos"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{disabled:p<=1,onClick:()=>h(e=>Math.max(1,e-1)),className:"px-3 py-1 rounded bg-gray-100",children:"Anterior"}),(0,r.jsx)("button",{disabled:p>=w,onClick:()=>h(e=>Math.min(w,e+1)),className:"px-3 py-1 rounded bg-gray-100",children:"Siguiente"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-[#038C65] mb-4",children:"Movimientos recientes"}),(0,r.jsx)("div",{className:"space-y-3",style:{maxHeight:520,overflow:"auto"},children:0===s.length?(0,r.jsx)("div",{className:"text-gray-500",children:"Sin movimientos"}):s.map(e=>{var t,a;return(0,r.jsxs)("div",{className:"border rounded p-3",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:(null===(t=e.producto)||void 0===t?void 0:t.nombre)||"Producto"}),(0,r.jsx)("div",{className:"text-xs text-gray-600",children:new Date(e.fecha).toLocaleString()}),(0,r.jsxs)("div",{className:"text-sm",children:["Tipo: ",e.tipo_movimiento," - Cantidad: ",g(null!==(a=e.cantidad_base)&&void 0!==a?a:0)]}),e.comentario&&(0,r.jsx)("div",{className:"text-xs text-gray-700",children:e.comentario})]},e.id)})})]})]})]})}}},function(e){e.O(0,[398,888,774,179],function(){return e(e.s=220)}),_N_E=e.O()}]);